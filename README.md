# Motivation

This code was developed to improve the HAPI metadata served at https://cdaweb.gsfc.nasa.gov/hapi.

Three developers have written software to produce HAPI metadata using different methods. Each approach taken has limitations and flaws in the produced metadata. This repository can be used to compare metadata generated by each method.

This repository contains software for a fourth method that uses the CDAS REST service https://cdaweb.gsfc.nasa.gov/WebServices/REST/.

For comparison, the four methods are used to create HAPI `all.json` files. A HAPI `all.json` file is array of datasets from the `/catalog` endpoint with an additional `info` node for each dataset that contains the response to `/info` for that dataset.

The file `compare.json` contains the content from the four `all` files with keys to indicate the method. The keys are `bw`, `nl`, `bh`, and `jf`, which are the initials of the person who developed the softare that generates the HAPI metatada.

The methods are

1. `bw`, which uses https://spdf.gsfc.nasa.gov/pub/catalogs/all.xml
   
   and queries for JSON CDFML to

   https://cdaweb.gsfc.nasa.gov/WebServices/REST/

2. `nl`, which uses master CDFs

3. `bh`, which uses SPASE records

4. `jf`, which uses master CDFs

# Use

Requires [`Node.js`](https://nodejs.org/en/).

In reference to the above four options, to create metadata for all CDAWeb IDs that match `^AC_`, use

1. `node CDAS2HAPIa.js --idregex '^AC_'` creates `all/all-bw.json` and `all-bw-full.json`. The `full` file contains extra master CDF metadata in `x_` keys.
2. `node HAPI2HAPIa.js --version 'nl' --idregex '^AC_'` creates `all/all-nl.json`
3. `node HAPI2HAPIa.js --version 'bh' --idregex '^AC_'`c reates `all/all-bh.json` and `all-bh-full.json`. The `full` file contains extra SPASE metadata in `x_` keys.
4. `node HAPI2HAPIa.js --version 'jf' --idregex '^AC_'` reates `all/all-jf.json` and `all-bh-full.json`. 

# To Do

1. Handle non-string `DEPEND_1`
1. Validate using hapi-server.org/verify