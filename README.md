# Motivation

This code was developed to improve the HAPI metadata served at https://cdaweb.gsfc.nasa.gov/hapi.

Three developers have written software to produce HAPI metadata using different methods. Each approach taken has limitations and some errors in the produced metadata. This repository can be used to compare metadata generated by each method.

This repository contains

* scripts for a fourth method that uses the CDAS REST service https://cdaweb.gsfc.nasa.gov/WebServices/REST/. The script that generates metadata is `CDAS2HAPIall.js` (~1000 lines). The script that transforms CDAS data responses to HAPI data responses is `CDAS2HAPIcsv.js` (~100 lines);

* scripts that are used to create HAPI `all.json` files for each method (see `Makefile`). A HAPI `all.json` file is array of datasets from the `/catalog` endpoint with an additional `info` node for each dataset that contains the response to `/info` for that dataset; and

* a script to compare the results from 2. The file `compare/compare-meta.json` contains the content from the four `all` files with keys to indicate the method. The keys are `bw`, `nl`, `bh`, and `jf`, which are the initials of the person who developed the software that generates the HAPI metatada.

The four methods are

1. `bw`, which uses the new in this repository that uses https://spdf.gsfc.nasa.gov/pub/catalogs/all.xml
   
   and queries for JSON CDFML to

   https://cdaweb.gsfc.nasa.gov/WebServices/REST/

2. `nl`, which uses master CDFs; https://git.mysmce.com/spdf/hapi-nand. This code is used for the production CDAWeb HAPI server at https://cdaweb.gsfc.nasa.gov/hapi.

3. `bh`, which uses SPASE records; https://cdaweb.gsfc.nasa.gov/registry/hdp/hapi/. This is a prototype server and it serves only CDAWeb datasets for which a SPASE record is available.

4. `jf`, which uses master CDFs; https://sourceforge.net/p/autoplot/code/HEAD/tree/. The code that produces HAPI metadata is also a prototype and is not indended for production use.

# Use

Requires [`Node.js`](https://nodejs.org/en/).

In reference to the above four options, to create metadata for all CDAWeb IDs that match `^AC_`, use

1. `node CDAS2HAPIall.js --idregex '^AC_'` creates `all/all-bw.json` and `all-bw-full.json`. The `full` file contains extra master CDF metadata in an `additionalMetadata` node.
2. `node HAPI2HAPIall.js --version 'nl' --idregex '^AC_'` creates `all/all-nl.json`
3. `node HAPI2HAPIall.js --version 'bh' --idregex '^AC_'`c reates `all/all-bh.json` and `all-bh-full.json`. The `full` file contains extra SPASE and SPDF metadata as values of `x_` keys.
4. `node HAPI2HAPIall.js --version 'jf' --idregex '^AC_'` reates `all/all-jf.json` and `all-bh-full.json`.

# Observations and Comments


